---
description:
globs:
alwaysApply: false
---
# Nix 파일 수정 후 테스트 절차

Nix flakes 기반 프로젝트에서 nix 파일(예: flake.nix, 모듈 등)을 수정한 후에는 반드시 아래 절차에 따라 테스트를 진행해야 한다.

## 1. 구문 및 평가 테스트
- nix 파일을 수정한 후, flake가 정상적으로 평가되는지 확인한다.
- 명령어:
  ```sh
  nix flake check
  ```
- 필요시, 특정 시스템/호스트에 대해 빌드 평가를 진행한다.
  ```sh
  nix build .#darwinConfigurations.<hostname>.system
  ```
  또는
  ```sh
  nix build .#homeConfigurations.<username>@<hostname>.activationPackage
  ```

## 2. 드라이런(Dry-run) 적용 테스트
- 실제 시스템에 적용하지 않고, 변경사항을 미리 확인한다.
- macOS(darwin):
  ```sh
  nixos-rebuild switch --flake .#<hostname> --dry-run
  ```
- home-manager(Linux 또는 macOS):
  ```sh
  home-manager switch --flake .#<username>@<hostname> --dry-run
  ```

## 3. 실제 적용
- 위 과정에서 문제가 없다면 실제로 시스템에 적용하여 테스트한다.
- macOS(darwin):
  ```sh
  nixos-rebuild switch --flake .#<hostname>
  ```
- home-manager:
  ```sh
  home-manager switch --flake .#<username>@<hostname>
  ```

## 4. flake.lock 갱신
- flakes의 input을 변경한 경우, 아래 명령어로 갱신한다.
  ```sh
  nix flake update
  ```

---
- 위 명령어에서 <hostname>, <username>은 실제 환경에 맞게 대체한다.
- 오류 발생 시, 로그를 확인하고 수정 후 다시 위 절차를 반복한다.
