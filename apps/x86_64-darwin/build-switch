#!/bin/sh -e

# Platform-specific configuration for x86_64-darwin
SYSTEM_TYPE="x86_64-darwin"
FLAKE_SYSTEM="darwinConfigurations.${SYSTEM_TYPE}.system"
PLATFORM_TYPE="darwin"
PLATFORM_NAME="Nix Darwin"
REBUILD_COMMAND="darwin-rebuild"
# Implement fallback path resolution for REBUILD_COMMAND_PATH
if [ -f "./result/sw/bin/darwin-rebuild" ]; then
    REBUILD_COMMAND_PATH="./result/sw/bin/darwin-rebuild"
elif command -v darwin-rebuild >/dev/null 2>&1; then
    REBUILD_COMMAND_PATH="darwin-rebuild"
else
    REBUILD_COMMAND_PATH="/run/current-system/sw/bin/darwin-rebuild"
fi

# Darwin-specific environment
export NIXPKGS_ALLOW_UNFREE=1

# Get the directory of this script
SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
PROJECT_ROOT=$(cd "$SCRIPT_DIR/../.." && pwd)

# Source the common build-switch logic
. "$PROJECT_ROOT/scripts/build-switch-common.sh"

# Execute the common build-switch workflow
execute_build_switch "$@"
