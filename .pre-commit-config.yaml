# ABOUTME: Pre-commit configuration for dotfiles repository
# ABOUTME: Includes Nix flake validation, shell script, YAML and Markdown linting
# 성능 최적화: 실행 시간 ~1.1초, exclude 패턴으로 불필요한 파일 제외

# Pre-commit hooks configuration for comprehensive code quality checks
# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks

repos:
  # ============================================================================
  # Nix-specific hooks (local repository)
  # ============================================================================
  - repo: local
    hooks:
      # Nix flake structure and syntax validation
      - id: nix-flake-check
        name: Nix Flake Check
        entry: nix flake check --all-systems --no-build
        language: system
        files: ^.*\\.nix$
        pass_filenames: false
        require_serial: true

  # ============================================================================
  # File-specific linting hooks
  # ============================================================================
  - repo: local
    hooks:
      # Shell script analysis with shellcheck
      - id: shellcheck
        name: ShellCheck
        entry: shellcheck
        language: system
        files: \.(sh|bash|zsh)$
        exclude: (modules/shared/config/p10k\.zsh$|node_modules/|\.git/|result/)
        args: [--external-sources, --exclude=SC1091]

      # Additional shellcheck for scripts/ directory (executable files)
      - id: shellcheck-scripts
        name: ShellCheck (scripts/)
        entry: shellcheck
        language: system
        files: ^scripts/[^/]*$
        exclude: \.txt$
        args: [--external-sources, --exclude=SC1091, --severity=error]

      # YAML file validation with yamllint
      - id: yamllint
        name: yamllint
        entry: yamllint
        language: system
        files: \.(yaml|yml)$
        exclude: (node_modules/|\.git/|result/)
        args: [-d, "{extends: relaxed, rules: {line-length: {max: 120}, trailing-spaces: disable, new-line-at-end-of-file: disable}}"]

      # Markdown file linting with markdownlint
      - id: markdownlint
        name: markdownlint
        entry: markdownlint
        language: system
        files: \.md$
        exclude: (node_modules/|\.git/|result/)
        args: [--disable, MD013, --disable, MD047]

  # ============================================================================
  # General file quality hooks
  # ============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Remove trailing whitespace from all files
      - id: trailing-whitespace
        exclude: (\.patch$|node_modules/|\.git/|result/|\.nix-store/)

      # Ensure files end with a newline character
      - id: end-of-file-fixer
        exclude: (\.patch$|node_modules/|\.git/|result/|\.nix-store/)

      # Check for merge conflict markers
      - id: check-merge-conflict
        exclude: (node_modules/|\.git/|result/|\.nix-store/)

      # Basic YAML syntax validation (disabled - using yamllint instead)
      # - id: check-yaml
      #   exclude: \.github/

      # Basic JSON syntax validation
      - id: check-json
        exclude: (node_modules/|\.git/|result/|\.nix-store/)
