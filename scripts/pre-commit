#!/bin/sh

echo "ğŸ” Running pre-commit checks (matching CI)..."

# Check if tools are installed
if ! command -v golangci-lint >/dev/null 2>&1 || ! command -v goimports >/dev/null 2>&1; then
    echo "âŒ Development tools not found"
    echo "ğŸ’¡ Run 'make install-tools' to install CI-compatible tools"
    exit 1
fi

# Format check with tools available
echo "ğŸ“ Running format check..."
make fmt-strict
if [ $? -ne 0 ]; then
    echo "âŒ Format check failed"
    echo "ğŸ’¡ Run 'make install-tools' to install required tools"
    exit 1
fi

# Stage formatted files
git add -A

# Lint check (same as CI lint-check job)
echo "ğŸ” Running linter (same as CI)..."
make lint
if [ $? -ne 0 ]; then
    echo "âŒ Lint check failed (same as CI)"
    exit 1
fi

echo "âœ… Pre-commit checks passed (CI compatible)"