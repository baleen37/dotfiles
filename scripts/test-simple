#!/usr/bin/env bash

# Simple test for auto branch update workflow

set -e

echo "🧪 Testing Auto Branch Update (Simple)"
echo "======================================="

# Test 1: Check workflow exists
if [ -f ".github/workflows/auto-branch-update.yml" ]; then
    echo "✅ Workflow file exists"
else
    echo "❌ Workflow file missing"
    exit 1
fi

# Test 2: Check required tools
if command -v gh &> /dev/null && command -v jq &> /dev/null; then
    echo "✅ Required tools available (gh, jq)"
else
    echo "❌ Missing required tools"
    exit 1
fi

# Test 3: Check if authenticated with GitHub
if gh auth status &> /dev/null; then
    echo "✅ GitHub CLI authenticated"

    # Test 4: List current PRs
    echo "📋 Current open PRs:"
    gh pr list --state open --json number,headRefName | jq -r '.[] | "  - PR #\(.number): \(.headRefName)"'

else
    echo "⚠️  GitHub CLI not authenticated - some features won't work"
fi

echo ""
echo "🎉 Basic tests passed!"
echo ""
echo "To test the workflow:"
echo "1. git add . && git commit -m 'feat: add auto branch update'"
echo "2. git push origin feat/auto-branch-update"
echo "3. Create a PR and enable auto-merge"
echo "4. Push to main to trigger the workflow"
